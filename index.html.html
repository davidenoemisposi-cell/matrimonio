<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<title>Giulia & Marco — 12.09.2026</title>
<style>
  @font-face {
    font-family: "VintageM";
    src: url("VintageMDemo-Yqqx2.ttf") format("truetype");
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }
  
  @font-face {
    font-family: "Housttely Signature";
    src:     font-weight: normal;
    font-style: normal;
    font-display: swap;
  }
  
  @font-face {
    font-family: "Playfair Display";
    src: url("PlayfairDisplayRegular-ywLOY.ttf") format("truetype");
    font-weight: 400;
    font-style: normal;
    font-display: swap;
  }
  
  @font-face {
    font-family: "Playfair Display";
    src: url("PlayfairDisplayMedium-9YKZK.ttf") format("truetype");
    font-weight: 500;
    font-style: normal;
    font-display: swap;
  }
  
  @font-face {
    font-family: "Playfair Display";
    src: url("PlayfairDisplaySemibold-lg9nd.ttf") format("truetype");
    font-weight: 600;
    font-style: normal;
    font-display: swap;
  }
  
  @font-face {
    font-family: "Playfair Display";
    src: url("PlayfairDisplayBold-nRv8g.ttf") format("truetype");
    font-weight: 700;
    font-style: normal;
    font-display: swap;
  }
  
  @font-face {
    font-family: "Playfair Display";
    src: url("PlayfairDisplayItalic-BW0Rd.ttf") format("truetype");
    font-weight: 400;
    font-style: italic;
    font-display: swap;
  }
</style>
<link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,opsz,wght@0,6..96,400;0,6..96,500;0,6..96,600;0,6..96,700;1,6..96,400&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500&family=Outfit:wght@200;300;400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lucide-static@0.263.1/font/lucide.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
<style>
  :root {
    --verde: #7A8B72;
    --verde-chiaro: #96A88E;
    --crema: #F0E5D3;
    --sabbia: #CFC4A8;
    --verde-scuro: #5F6E58;
    --verde-sbiadito: #ADBEA6;
    --crema-chiaro: #F7F0E2;
    --sabbia-chiaro: #DDD5C0;
    --sabbia-scuro: #B8AD94;
  }

  /* ——— DESKTOP PHONE FRAME ——— */
  @media (min-width: 768px) {
    body {
      background: var(--crema);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    body.no-scroll {
      display: flex;
      overflow: hidden;
      position: static;
    }

    body.no-scroll .phone-frame {
      overflow: hidden;
    }

    .phone-frame {
      position: relative;
      width: 390px;
      max-width: 390px;
      height: calc(100vh - 4rem);
      margin: 2rem auto;
      border-radius: 40px;
      overflow-x: hidden;
      overflow-y: auto;
      box-shadow: 
        0 0 0 8px #1a1a1a,
        0 0 0 10px #333,
        0 20px 60px rgba(0,0,0,0.25),
        0 0 100px rgba(122,139,114,0.08);
    }

    .phone-frame::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      height: 28px;
      background: #1a1a1a;
      border-radius: 0 0 16px 16px;
      z-index: 999999;
    }

    .video-intro {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 40px;
      z-index: 99999;
    }

    .video-intro .intro-video {
      border-radius: 40px;
    }

    .hero {
      min-height: calc(100vh - 4rem);
    }

    .seal-hotspot {
      /* Ricalcola posizione per dimensione phone frame */
    }

    .tap-hint {
      border-radius: 0 0 40px 40px;
    }

    /* Desktop background decoration */
    body::before {
      content: 'G & M';
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'Playfair Display', serif;
      font-weight: 400;
      font-size: 15rem;
      color: var(--sabbia-chiaro);
      opacity: 0.3;
      z-index: -1;
      pointer-events: none;
      letter-spacing: 0.05em;
    }

    body::after {
      content: '12 · 09 · 2026';
      position: fixed;
      bottom: 3rem;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'Outfit', sans-serif;
      font-size: 0.7rem;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      color: var(--sabbia);
      opacity: 0.5;
      z-index: -1;
      pointer-events: none;
    }
  }

  @media (max-width: 767px) {
    .phone-frame {
      width: 100%;
      max-width: 100%;
    }
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  html {
    scroll-behavior: smooth;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    font-family: 'Outfit', sans-serif;
    font-weight: 300;
    background: var(--crema-chiaro);
    color: var(--verde-scuro);
    min-height: 100dvh;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
  }

  /* Blocca scroll quando video intro è attivo */
  body.no-scroll {
    overflow: hidden;
    position: fixed;
    width: 100%;
    height: 100%;
  }

  /* ——— VIDEO INTRO ——— */
  .video-intro {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100dvh;
    background: #1a1a1a;
    z-index: 99999;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 1.2s ease-out;
  }

  .video-intro.fade-out {
    opacity: 0;
    pointer-events: none;
  }

  .video-intro.hidden {
    display: none;
  }

  .intro-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  @media (min-width: 768px) {
    .video-intro {
      position: absolute !important;
      top: 0;
      left: 0;
      width: 100% !important;
      height: 100% !important;
      border-radius: 40px;
    }

    .intro-video {
      border-radius: 40px;
    }

    .tap-hint {
      border-radius: 0 0 40px 40px;
    }
  }

  /* Zona cliccabile sul sigillo - invisibile */
  .seal-hotspot {
    position: absolute;
    bottom: 32%;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 100px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 10;
  }

  .tap-hint {
    position: absolute;
    bottom: 18%;
    left: 50%;
    transform: translateX(-50%);
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-size: 1.1rem;
    color: rgba(255,255,255,0.85);
    letter-spacing: 0.1em;
    opacity: 0;
    visibility: hidden;
  }

  .tap-hint.visible {
    visibility: visible;
    animation: fadeInHint 1s ease forwards, pulseHint 2.5s ease-in-out 1s infinite;
  }

  @keyframes fadeInHint {
    to { opacity: 1; }
  }

  @keyframes pulseHint {
    0%, 100% { 
      opacity: 0.85;
      transform: translateX(-50%) scale(1);
    }
    50% { 
      opacity: 1;
      transform: translateX(-50%) scale(1.05);
    }
  }

  .tap-hint.hidden {
    opacity: 0 !important;
    transition: opacity 0.3s ease;
  }

  /* ——— PAPER TEXTURE OVERLAY (disabilitato) ——— */

  /* ——— HERO ——— */
  .hero {
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    text-align: center;
    padding: 1rem 1.5rem 3rem;
    position: relative;
    background: var(--crema-chiaro);
    overflow: hidden;
  }

  /* Dark overlay sul video per far risaltare il testo */
  .hero::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0.25) 0%,
      rgba(0, 0, 0, 0.08) 35%,
      rgba(0, 0, 0, 0.05) 60%,
      rgba(0, 0, 0, 0.25) 100%
    );
    z-index: 1;
    pointer-events: none;
  }

  .hero-video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 0;
    pointer-events: none;
  }

  /* Video 2 nascosto di default */
  .hero-video-2 {
    opacity: 0;
    z-index: 1;
  }

  .hero-video-2.active {
    opacity: 1;
  }

  /* Nasconde controlli video su tutti i browser */
  .hero-video::-webkit-media-controls,
  .hero-video-2::-webkit-media-controls {
    display: none !important;
  }
  .hero-video::-webkit-media-controls-enclosure,
  .hero-video-2::-webkit-media-controls-enclosure {
    display: none !important;
  }
  .hero-video::-webkit-media-controls-panel,
  .hero-video-2::-webkit-media-controls-panel {
    display: none !important;
  }
  .hero-video::-webkit-media-controls-play-button,
  .hero-video-2::-webkit-media-controls-play-button {
    display: none !important;
  }
  .hero-video::-webkit-media-controls-start-playback-button,
  .hero-video-2::-webkit-media-controls-start-playback-button {
    display: none !important;
  }
  .hero-video::-moz-media-controls,
  .hero-video-2::-moz-media-controls {
    display: none !important;
  }

  .hero-names {
    font-family: 'Playfair Display', serif;
    font-weight: 400;
    font-size: clamp(3.5rem, 14vw, 5.5rem);
    line-height: 0.95;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--crema);
    text-shadow: 
      0 2px 15px rgba(0, 0, 0, 0.25),
      0 0 30px rgba(255, 255, 255, 0.3);
    opacity: 0;
    animation: fadeIn 1.2s ease 0.5s forwards;
    position: absolute;
    top: 2.2rem;
    left: 0;
    right: 0;
    z-index: 2;
  }

  .hero-and {
    font-family: 'Playfair Display', serif;
    font-style: italic;
    font-size: clamp(2.2rem, 8vw, 3.2rem);
    color: rgba(240, 229, 211, 0.9);
    margin: 0.1em auto;
    display: block;
    text-transform: lowercase;
    letter-spacing: 0.05em;
  }

  .hero-request {
    font-size: 0.7rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: rgba(240, 229, 211, 0.85);
    text-shadow: 0 1px 10px rgba(0, 0, 0, 0.2), 0 0 20px rgba(255, 255, 255, 0.2);
    line-height: 2;
    margin-top: 1.2rem;
    opacity: 0;
    animation: fadeIn 1s ease 0.9s forwards;
    position: relative; z-index: 2;
  }

  .hero-date-block {
    position: absolute;
    bottom: 3rem;
    left: 0;
    right: 0;
    width: 100%;
    text-align: center;
    opacity: 0;
    animation: fadeIn 1s ease 1.2s forwards;
    z-index: 2;
  }

  .hero-date-line {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 400;
    font-size: 1.5rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--crema);
    text-shadow: 
      0 2px 15px rgba(0, 0, 0, 0.35),
      0 1px 4px rgba(0, 0, 0, 0.2);
  }

  .hero-ceremony-time {
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-weight: 300;
    font-size: 1.05rem;
    color: rgba(240, 229, 211, 0.85);
    text-shadow: 0 1px 10px rgba(0, 0, 0, 0.2);
    margin-top: 0.4rem;
  }

  .hero-venue-block {
    margin-top: 1rem;
    opacity: 0;
    animation: fadeIn 1s ease 1.5s forwards;
    position: relative; z-index: 2;
  }

  .hero-venue-name {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 600;
    font-size: 0.9rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: rgba(240, 229, 211, 0.95);
    text-shadow: 0 1px 10px rgba(0, 0, 0, 0.2);
  }

  .hero-venue-address {
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-weight: 300;
    font-size: 0.95rem;
    color: rgba(240, 229, 211, 0.8);
    text-shadow: 0 1px 8px rgba(0, 0, 0, 0.15);
    margin-top: 0.2rem;
    line-height: 1.5;
  }

  .hero-follow {
    font-family: 'Housttely Signature', 'Cormorant Garamond', serif;
    font-size: 1.4rem;
    color: rgba(240, 229, 211, 0.9);
    text-shadow: 0 1px 10px rgba(0, 0, 0, 0.2);
    margin-top: 1rem;
    opacity: 0;
    animation: fadeIn 1s ease 1.8s forwards;
    position: relative; z-index: 2;
  }

  .scroll-hint {
    position: absolute;
    bottom: 1.2rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.3rem;
    opacity: 0;
    animation: fadeIn 1s ease 2.2s forwards;
    cursor: pointer;
    transition: transform 0.3s ease;
    z-index: 2;
  }

  .scroll-hint:active {
    transform: scale(0.95);
  }

  .scroll-hint-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.2rem;
    margin-top: 0.8rem;
    padding-top: 0.5rem;
    cursor: pointer;
    transition: transform 0.3s ease;
  }

  .scroll-hint-section:active {
    transform: scale(0.95);
  }

  .scroll-hint-section .scroll-text {
    font-size: 0.65rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--crema);
  }

  .scroll-hint-section .scroll-arrow {
    animation: bounce 2s ease-in-out infinite;
  }

  .scroll-hint-section .scroll-arrow svg {
    stroke: var(--crema);
  }

  .scroll-text {
    font-size: 0.65rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--crema);
    text-shadow: 0 1px 6px rgba(0, 0, 0, 0.3);
  }

  .scroll-arrow {
    animation: bounce 2s ease-in-out infinite;
  }

  .scroll-arrow svg {
    width: 25px;
    height: 25px;
    stroke: var(--crema);
    filter: drop-shadow(0 1px 4px rgba(0, 0, 0, 0.3));
  }

  @keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
      transform: translateY(0);
      opacity: 0.6;
    }
    40% {
      transform: translateY(6px);
      opacity: 1;
    }
    60% {
      transform: translateY(3px);
      opacity: 0.8;
    }
  }

  .maps-btn-hero {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.8rem;
    padding: 0.65rem 1.3rem;
    background: transparent;
    color: var(--verde);
    text-decoration: none;
    font-family: 'Outfit', sans-serif;
    font-size: 0.65rem;
    font-weight: 300;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    border: 1px solid var(--sabbia);
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .maps-btn-hero:active {
    transform: scale(0.97);
    background: rgba(122,139,114,0.08);
  }

  .maps-btn-hero svg {
    stroke: var(--verde-chiaro);
  }

  /* ——— INVITO ——— */
  .invite-section {
    background: var(--crema);
    position: relative;
  }

  .invite-content {
    padding: 2rem 2.5rem;
    max-width: 420px;
    margin: 0 auto;
    text-align: center;
    opacity: 0;
    transform: translateY(25px);
    transition: all 0.9s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    z-index: 2;
  }
  .invite-content.visible { opacity: 1; transform: translateY(0); }

  .invite-text {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 300;
    font-style: italic;
    font-size: 1.15rem;
    line-height: 1.9;
    color: var(--verde);
    letter-spacing: 0.02em;
  }

  /* ——— SECTIONS ——— */
  .page {
    position: relative;
    overflow: hidden;
  }

  .section {
    padding: 3.5rem 2rem;
    max-width: 420px;
    margin: 0 auto;
    text-align: center;
    opacity: 0;
    transform: translateY(25px);
    transition: all 0.9s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    z-index: 2;
  }
  .section.visible { opacity: 1; transform: translateY(0); }

  .section-script {
    font-family: 'Housttely Signature', 'Cormorant Garamond', serif;
    font-size: 2.8rem;
    color: var(--verde);
    margin-bottom: 0.3rem;
  }

  .section-label {
    font-size: 0.75rem;
    letter-spacing: 0.35em;
    text-transform: uppercase;
    color: var(--sabbia-scuro);
    margin-bottom: 1.5rem;
  }

  .section-text {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 300;
    font-style: italic;
    font-size: 1.1rem;
    line-height: 1.8;
    color: var(--verde-chiaro);
  }

  /* ——— VENUE CARDS ——— */
  .venue-card {
    margin-top: 2rem;
    padding: 2rem 1.5rem;
    background: rgba(240,229,211,0.5);
    border: 1px solid var(--sabbia-chiaro);
    border-radius: 12px;
    text-align: center;
  }

  .venue-card .icon {
    margin-bottom: 1rem;
    display: flex;
    justify-content: center;
  }

  .venue-card h3 {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 600;
    font-size: 1.05rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--verde);
    margin-bottom: 0.5rem;
  }

  .venue-card p {
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-weight: 300;
    font-size: 1.05rem;
    color: var(--verde-chiaro);
    line-height: 1.5;
  }

  .venue-card .time-badge {
    display: inline-block;
    font-family: 'Outfit', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: var(--verde);
    border: 1px solid var(--sabbia);
    padding: 0.35rem 1rem;
    margin-top: 0.8rem;
  }

  .maps-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.6rem;
    margin-top: 2rem;
    padding: 0.9rem 1.8rem;
    background: var(--verde);
    color: var(--crema);
    text-decoration: none;
    font-family: 'Outfit', sans-serif;
    font-size: 0.65rem;
    font-weight: 300;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .maps-btn:active {
    transform: scale(0.97);
    opacity: 0.9;
  }

  .maps-btn-light {
    background: var(--sabbia);
    color: var(--verde-scuro);
    margin-top: 2.5rem;
  }

  /* ——— LUOGO ——— */
  .details-section {
    background: var(--crema-chiaro);
    position: relative;
  }

  .details-content {
    padding: 3.5rem 2rem;
    max-width: 420px;
    margin: 0 auto;
    text-align: center;
    opacity: 0;
    transform: translateY(25px);
    transition: all 0.9s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    z-index: 2;
  }
  .details-content.visible { opacity: 1; transform: translateY(0); }

  .location-box {
    margin-top: 1.5rem;
    background: rgba(240,229,211,0.5);
    border: 1px solid var(--sabbia-chiaro);
    border-radius: 14px;
    overflow: hidden;
  }

  .location-map {
    width: 100%;
    height: 280px;
    border: none;
    display: block;
    border-radius: 14px 14px 0 0;
  }

  /* Leaflet minimal overrides */
  .location-map .leaflet-control-zoom {
    border: none !important;
    border-radius: 8px !important;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
  }

  .location-map .leaflet-control-zoom a {
    color: var(--verde-scuro) !important;
    background: rgba(255,255,255,0.95) !important;
    border-bottom: 1px solid rgba(0,0,0,0.08) !important;
  }

  .location-map .leaflet-control-attribution {
    font-size: 8px;
    opacity: 0.4;
    background: transparent !important;
  }

  /* Custom popup */
  .leaflet-popup-content-wrapper {
    border-radius: 8px !important;
    box-shadow: 0 4px 15px rgba(0,0,0,0.12) !important;
    padding: 0 !important;
  }

  .leaflet-popup-tip {
    box-shadow: none !important;
  }

  .leaflet-popup-close-button {
    display: none !important;
  }

  .location-info {
    padding: 1.3rem 1.5rem;
    text-align: center;
  }

  .location-name {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 600;
    font-size: 1.05rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--verde);
  }

  .location-address {
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-weight: 300;
    font-size: 0.95rem;
    color: var(--verde-chiaro);
    margin-top: 0.3rem;
    line-height: 1.5;
  }

  .location-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1rem;
    padding: 0.7rem 1.5rem;
    background: var(--verde);
    color: var(--crema);
    text-decoration: none;
    font-family: 'Outfit', sans-serif;
    font-size: 0.65rem;
    font-weight: 300;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .location-btn:active {
    transform: scale(0.97);
    opacity: 0.9;
  }

  .location-btn svg {
    width: 14px;
    height: 14px;
    stroke: var(--crema);
    stroke-width: 1.5;
    fill: none;
  }

  /* ——— SCHEDULE TIMELINE ——— */
  .timeline-section {
    background: var(--verde);
    padding: 0;
    position: relative;
  }

  .timeline-content {
    padding: 2.5rem 1.5rem 1.5rem;
    max-width: 420px;
    margin: 0 auto;
    text-align: center;
    opacity: 0;
    transform: translateY(25px);
    transition: all 0.9s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    z-index: 2;
  }
  .timeline-content.visible { opacity: 1; transform: translateY(0); }

  .timeline-content .section-script {
    color: var(--crema);
  }

  .timeline-content .section-label {
    color: var(--sabbia);
  }

  .timeline {
    margin-top: 1.2rem;
    position: relative;
    padding: 0;
  }

  .tl-item {
    position: relative;
    display: flex;
    align-items: center;
    margin-bottom: 0;
  }

  .tl-item:last-child {
    margin-bottom: 0;
  }

  /* alternating sides */
  .tl-item.left {
    flex-direction: row;
  }
  .tl-item.right {
    flex-direction: row-reverse;
  }

  .tl-side {
    width: calc(50% - 28px);
    text-align: right;
  }
  .tl-item.right .tl-side {
    text-align: left;
  }

  /* center column: line-top + time + line-bottom */
  .tl-center {
    width: 56px;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
  }

  .tl-line-segment {
    width: 1px;
    height: 2.5rem;
    background: linear-gradient(to bottom, var(--sabbia), transparent);
  }

  .tl-line-segment.bottom {
    background: linear-gradient(to top, var(--sabbia), transparent);
  }

  .tl-dot-time {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 400;
    font-size: 0.9rem;
    letter-spacing: 0.03em;
    color: var(--crema);
    line-height: 1;
    padding: 0.15rem 0;
  }

  .rsvp-icon {
    width: 32px;
    height: 32px;
    stroke: var(--verde);
    stroke-width: 1.5;
    fill: none;
  }

  .tl-event {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 400;
    font-size: 1.2rem;
    color: var(--crema);
    letter-spacing: 0.03em;
  }

  /* ——— INTOLLERANZE & NOTE ——— */
  .message-page {
    background: var(--verde);
    position: relative;
  }

  .message-content {
    padding: 3.5rem 2rem;
    max-width: 500px;
    margin: 0 auto;
    text-align: center;
    opacity: 0;
    transform: translateY(25px);
    transition: all 0.9s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    z-index: 2;
  }
  .message-content.visible { opacity: 1; transform: translateY(0); }

  .message-content .section-script { color: var(--crema); }
  .message-content .section-label { color: var(--sabbia); }
  .message-content .section-text { color: rgba(240,229,211,0.85); }

  .input-wrapper {
    position: relative;
  }

  .elegant-textarea {
    width: 100%;
    padding: 1.2rem 1.4rem;
    background: rgba(247,240,226,0.9);
    border: 1px solid var(--sabbia-chiaro);
    border-radius: 12px;
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.05rem;
    font-weight: 400;
    color: var(--verde-scuro);
    line-height: 1.6;
    resize: none;
    transition: all 0.3s ease;
    -webkit-appearance: none;
  }

  .elegant-textarea:focus {
    outline: none;
    border-color: var(--sabbia);
    background: rgba(247,240,226,1);
    box-shadow: 0 0 0 3px rgba(240,229,211,0.3);
  }

  .elegant-textarea::placeholder {
    color: var(--sabbia-scuro);
    font-style: italic;
    font-weight: 300;
  }

  /* ——— COUNTDOWN (salvia) ——— */
  .countdown-section {
    background: var(--verde);
    position: relative;
  }

  .countdown-content {
    padding: 3rem 2rem;
    max-width: 420px;
    margin: 0 auto;
    text-align: center;
    opacity: 0;
    transform: translateY(25px);
    transition: all 0.9s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    z-index: 2;
  }
  .countdown-content.visible { opacity: 1; transform: translateY(0); }

  .countdown-content .section-script { color: var(--crema); }
  .countdown-content .section-label { color: var(--sabbia); }

  .countdown-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.8rem;
    margin-top: 1.8rem;
  }

  .cd-item {
    text-align: center;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 14px;
    padding: 1.4rem 0.5rem;
  }

  .cd-num {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 300;
    font-size: 3.2rem;
    line-height: 1;
    color: var(--crema);
  }

  .cd-label {
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--sabbia);
    margin-top: 0.4rem;
  }

  .calendar-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 2rem;
    padding: 0.75rem 1.5rem;
    background: rgba(255, 255, 255, 0.12);
    border: 1px solid rgba(255, 255, 255, 0.25);
    border-radius: 6px;
    color: var(--crema);
    text-decoration: none;
    font-family: 'Outfit', sans-serif;
    font-size: 0.65rem;
    font-weight: 300;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .calendar-btn:active {
    transform: scale(0.97);
    background: rgba(255, 255, 255, 0.18);
  }

  .calendar-btn svg {
    width: 16px;
    height: 16px;
    stroke: var(--crema);
    stroke-width: 1.5;
    fill: none;
  }

  /* ——— PERNOTTO ——— */
  .pernotto-section {
    background: var(--crema-chiaro);
    position: relative;
  }

  .pernotto-content {
    padding: 3.5rem 2rem;
    max-width: 420px;
    margin: 0 auto;
    text-align: center;
    opacity: 0;
    transform: translateY(25px);
    transition: all 0.9s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    z-index: 2;
  }
  .pernotto-content.visible { opacity: 1; transform: translateY(0); }

  .pernotto-box {
    margin-top: 1.5rem;
    background: rgba(240,229,211,0.5);
    border: 1px solid var(--sabbia-chiaro);
    border-radius: 14px;
    overflow: hidden;
  }

  .pernotto-map {
    width: 100%;
    height: 240px;
    border: none;
    display: block;
    border-radius: 14px 14px 0 0;
  }

  .pernotto-map .leaflet-control-zoom {
    border: none !important;
    border-radius: 8px !important;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
  }

  .pernotto-map .leaflet-control-zoom a {
    color: var(--verde-scuro) !important;
    background: rgba(255,255,255,0.95) !important;
    border-bottom: 1px solid rgba(0,0,0,0.08) !important;
  }

  .pernotto-map .leaflet-control-attribution {
    font-size: 8px;
    opacity: 0.4;
    background: transparent !important;
  }

  .pernotto-info {
    padding: 1.3rem 1.5rem;
    text-align: center;
  }

  .pernotto-name {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 600;
    font-size: 1.05rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--verde);
  }

  .pernotto-name a {
    color: var(--verde);
    text-decoration: none;
    border-bottom: 1px solid var(--sabbia);
    padding-bottom: 1px;
    transition: border-color 0.3s ease;
  }

  .pernotto-name a:active {
    border-color: var(--verde);
  }

  .pernotto-address {
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-weight: 300;
    font-size: 0.95rem;
    color: var(--verde-chiaro);
    margin-top: 0.3rem;
    line-height: 1.5;
  }

  .pernotto-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1rem;
    padding: 0.7rem 1.5rem;
    background: var(--verde);
    color: var(--crema);
    text-decoration: none;
    font-family: 'Outfit', sans-serif;
    font-size: 0.65rem;
    font-weight: 300;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .pernotto-btn:active {
    transform: scale(0.97);
    opacity: 0.9;
  }

  .pernotto-btn svg {
    width: 14px;
    height: 14px;
    stroke: var(--crema);
    stroke-width: 1.5;
    fill: none;
  }

  /* Selezione notti */
  .nights-selection {
    margin-top: 2rem;
  }

  .nights-label {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 600;
    font-size: 1rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--verde);
    margin-bottom: 1rem;
  }

  .night-items {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
  }

  .night-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.2rem;
    background: rgba(247,240,226,0.8);
    border: 1px solid var(--sabbia-chiaro);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    -webkit-user-select: none;
    user-select: none;
    text-align: left;
  }

  .night-item:active { transform: scale(0.98); }

  .night-item.selected {
    border-color: var(--verde);
    background: rgba(113,123,84,0.08);
  }

  .night-check {
    width: 24px; height: 24px;
    border-radius: 50%;
    border: 1.5px solid var(--sabbia);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all 0.3s ease;
  }

  .night-item.selected .night-check {
    background: var(--verde);
    border-color: var(--verde);
  }

  .night-check svg {
    width: 12px; height: 12px;
    stroke: var(--crema); stroke-width: 2.5; fill: none;
    opacity: 0; transform: scale(0.5);
    transition: all 0.25s ease;
  }

  .night-item.selected .night-check svg {
    opacity: 1; transform: scale(1);
  }

  .night-info { flex: 1; }

  .night-date {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 500;
    font-size: 1.15rem;
    color: var(--verde);
    letter-spacing: 0.03em;
  }

  .night-desc {
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-weight: 300;
    font-size: 0.9rem;
    color: var(--sabbia-scuro);
    margin-top: 0.15rem;
  }

  /* ——— PRE-WEDDING PARTY ——— */
  .prewedding-section {
    background: var(--verde);
    position: relative;
  }

  .prewedding-content {
    padding: 3.5rem 2rem;
    max-width: 420px;
    margin: 0 auto;
    text-align: center;
    opacity: 0;
    transform: translateY(25px);
    transition: all 0.9s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    z-index: 2;
  }
  .prewedding-content.visible { opacity: 1; transform: translateY(0); }

  .prewedding-content .section-script { color: var(--crema); }
  .prewedding-content .section-label { color: var(--sabbia); }

  .prewedding-text {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 300;
    font-style: italic;
    font-size: 1.1rem;
    line-height: 1.8;
    color: rgba(240,229,211,0.85);
  }

  /* ——— GUEST LIST (crema) ——— */
  .guest-page {
    background: var(--crema-chiaro);
    position: relative;
  }

  .guest-content {
    padding: 3.5rem 2rem 2rem;
    max-width: 800px;
    margin: 0 auto;
    text-align: center;
    opacity: 0;
    transform: translateY(25px);
    transition: all 0.9s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    z-index: 2;
  }
  .guest-content.visible { opacity: 1; transform: translateY(0); }

  /* ——— RSVP COLUMNS ——— */
  .rsvp-columns {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    margin-top: 2rem;
  }

  @media (min-width: 600px) {
    .rsvp-columns {
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }
  }

  .rsvp-column {
    background: rgba(240,229,211,0.5);
    border: 1px solid var(--sabbia-chiaro);
    border-radius: 12px;
    padding: 1.5rem;
  }

  .rsvp-column-header {
    text-align: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--sabbia-chiaro);
  }

  .rsvp-column-icon {
    margin-bottom: 0.8rem;
  }

  .rsvp-column-title {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 600;
    font-size: 1.2rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--verde);
  }

  .rsvp-column-subtitle {
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-weight: 300;
    font-size: 1rem;
    color: var(--verde-chiaro);
    margin-top: 0.3rem;
  }

  .guest-list {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
  }

  .guest-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.2rem;
    background: rgba(247,240,226,0.8);
    border: 1px solid var(--sabbia-chiaro);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    -webkit-user-select: none;
    user-select: none;
    text-align: left;
  }

  .guest-item:active { transform: scale(0.98); }

  .guest-item.selected {
    border-color: var(--verde);
    background: rgba(113,123,84,0.08);
  }

  .guest-check {
    width: 24px; height: 24px;
    border-radius: 50%;
    border: 1.5px solid var(--sabbia);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all 0.3s ease;
  }

  .guest-item.selected .guest-check {
    background: var(--verde);
    border-color: var(--verde);
  }

  .guest-check svg {
    width: 12px; height: 12px;
    stroke: var(--crema); stroke-width: 2.5; fill: none;
    opacity: 0; transform: scale(0.5);
    transition: all 0.25s ease;
  }

  .guest-item.selected .guest-check svg {
    opacity: 1; transform: scale(1);
  }

  .guest-info { flex: 1; }

  .guest-name {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 500;
    font-size: 1.25rem;
    color: var(--verde);
    letter-spacing: 0.03em;
    transition: all 0.3s ease;
  }

  .guest-relation {
    font-size: 0.75rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--sabbia-scuro);
    margin-top: 0.15rem;
  }

  .guest-counter {
    text-align: center;
    margin-top: 1rem;
    font-size: 0.8rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--verde-chiaro);
  }
  .guest-counter span { color: var(--verde); font-weight: 500; }

  .no-pool-guests {
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-weight: 300;
    font-size: 0.95rem;
    color: var(--sabbia-scuro);
    padding: 2rem 1rem;
    text-align: center;
  }

  .single-guest-toggle {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
  }

  /* ——— CONFIRM ——— */
  .confirm-wrapper {
    padding: 1.5rem 2rem 2rem;
    max-width: 420px;
    margin: 0 auto;
  }

  .confirm-btn {
    width: 100%;
    padding: 1.15rem 2rem;
    background: var(--verde);
    color: var(--crema);
    border: none;
    border-radius: 12px;
    font-family: 'Outfit', sans-serif;
    font-weight: 300;
    font-size: 0.8rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.4s ease;
  }

  .confirm-btn:active { transform: scale(0.98); }
  .confirm-btn:disabled { opacity: 0.2; cursor: not-allowed; }
  .confirm-btn.sent { background: var(--verde-chiaro); pointer-events: none; }

  /* ——— IBAN ——— */
  .iban-section {
    background: var(--crema-chiaro);
    position: relative;
  }

  .iban-content {
    padding: 2rem 2rem 4rem;
    max-width: 420px;
    margin: 0 auto;
    text-align: center;
    opacity: 0;
    transform: translateY(25px);
    transition: all 0.9s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    z-index: 2;
  }
  .iban-content.visible { opacity: 1; transform: translateY(0); }

  .iban-box {
    background: rgba(240,229,211,0.5);
    border: 1px solid var(--sabbia-chiaro);
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
  }

  .iban-intestatario {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 500;
    font-size: 1rem;
    color: var(--verde);
    letter-spacing: 0.05em;
    margin-bottom: 0.8rem;
  }

  .iban-code {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 500;
    font-size: 1rem;
    letter-spacing: 0.05em;
    color: var(--verde);
    word-break: break-all;
    line-height: 1.6;
  }

  .iban-code a {
    color: var(--verde-scuro) !important;
    text-decoration: none !important;
    pointer-events: none;
  }

  .iban-copy-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1.2rem;
    padding: 0.65rem 1.3rem;
    background: transparent;
    color: var(--verde);
    font-family: 'Outfit', sans-serif;
    font-size: 0.65rem;
    font-weight: 300;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    border: 1px solid var(--sabbia);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .iban-copy-btn:active {
    transform: scale(0.97);
    background: rgba(122,139,114,0.08);
  }

  .iban-copy-btn svg {
    stroke: var(--verde-chiaro);
  }

  /* ——— FOOTER ——— */
  .footer {
    background: var(--verde);
    text-align: center;
    padding: 4rem 2rem 3.5rem;
    position: relative;
  }

  .footer-names {
    font-family: 'Naervik', 'Cormorant Garamond', serif;
    font-weight: 400;
    font-size: 1.5rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--crema);
  }

  .footer-and {
    font-family: 'Housttely Signature', 'Cormorant Garamond', serif;
    font-size: 1.8rem;
    color: var(--sabbia);
    text-transform: none;
    letter-spacing: 0;
  }

  .footer-date {
    font-size: 0.65rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: var(--verde-chiaro);
    margin-top: 1.2rem;
  }

  .footer-love {
    font-family: 'Housttely Signature', 'Cormorant Garamond', serif;
    font-size: 1.4rem;
    color: var(--sabbia);
    margin-top: 0.6rem;
  }

  /* ——— TOAST ——— */
  .toast {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--verde);
    color: var(--crema);
    padding: 1rem 2rem;
    border-radius: 8px;
    font-size: 0.6rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    z-index: 100;
    transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    white-space: nowrap;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeInCenter {
    from { opacity: 0; transform: translateY(calc(-50% + 8px)); }
    to { opacity: 1; transform: translateY(-50%); }
  }
</style>
</head>
<body class="no-scroll">
<div class="phone-frame">

<!-- ——— VIDEO INTRO ——— -->
<div class="video-intro" id="videoIntro">
  <video 
    id="introVideo" 
    class="intro-video"
    playsinline
    preload="metadata"
    muted
  >
    <source src="intro-video.mp4" type="video/mp4">
  </video>
  
  <!-- Zona cliccabile sul sigillo - invisibile -->
  <div class="seal-hotspot" id="sealHotspot"></div>
  
  <!-- Hint per cliccare -->
  <div class="tap-hint" id="tapHint">Tocca il sigillo</div>
</div>

<!-- ——— HERO ——— -->
<section class="hero paper-texture">
  <!-- Video 1 Background - loop boomerang continuo -->
  <video class="hero-video" id="heroVideo" muted playsinline disablepictureinpicture controlslist="nodownload nofullscreen noremoteplayback">
    <source src="hero-bg.mp4" type="video/mp4">
  </video>
  
  <!-- Video 2 Background - parte per primo, poi ogni minuto -->
  <video class="hero-video hero-video-2" id="heroVideo2" muted playsinline disablepictureinpicture controlslist="nodownload nofullscreen noremoteplayback">
    <source src="bg-2.mp4" type="video/mp4">
  </video>
  
  <h1 class="hero-names">
    GIULIA
    <span class="hero-and">e</span>
    MARCO
  </h1>

  <div class="hero-date-block">
    <div class="hero-date-line">12 Settembre 2026</div>
  </div>

  <div class="scroll-hint" onclick="scrollToSection('invito')">
    <div class="scroll-arrow">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M7 10l5 5 5-5"/>
      </svg>
    </div>
  </div>
</section>

<!-- ——— INVITO ——— -->
<div class="invite-section" id="invito">
  <div class="invite-content" data-reveal>
    <p class="invite-text">
      Con immensa gioia vi invitiamo<br>a celebrare insieme a noi<br>il giorno in cui la nostra storia<br>diventerà per sempre.
    </p>
  </div>
</div>

<!-- ——— COUNTDOWN ——— -->
<div class="countdown-section" id="countdown">
  <div class="countdown-content" data-reveal>
    <div class="section-script">Mancano</div>
    <div class="section-label">al grande giorno</div>
    <div class="countdown-grid">
      <div class="cd-item">
        <div class="cd-num" id="cd-days">—</div>
        <div class="cd-label">Giorni</div>
      </div>
      <div class="cd-item">
        <div class="cd-num" id="cd-hours">—</div>
        <div class="cd-label">Ore</div>
      </div>
      <div class="cd-item">
        <div class="cd-num" id="cd-mins">—</div>
        <div class="cd-label">Min</div>
      </div>
      <div class="cd-item">
        <div class="cd-num" id="cd-secs">—</div>
        <div class="cd-label">Sec</div>
      </div>
    </div>
    <button class="calendar-btn" onclick="addToCalendar()">
      <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
      Aggiungi al calendario
    </button>
  </div>
</div>

<!-- ——— LUOGO ——— -->
<div class="details-section">
  <div class="details-content" data-reveal>
    <div class="section-script">Luogo</div>
    <div class="section-label">La Cerimonia</div>

    <!-- Location Box -->
    <div class="location-box">
      <div id="osm-map" class="location-map"></div>
      <div class="location-info">
        <div class="location-name">Masseria San Michele</div>
        <div class="location-address">Strada Cupa 7, 74015 Martina Franca (TA)</div>
        <button class="location-btn" onclick="openMaps(event)">
          <svg viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
          Apri in Maps
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ——— PHOTO BREAK ——— -->
<div style="width:100%; overflow:hidden; line-height:0;">
  <img src="table.png" alt="" style="width:100%; height:auto; display:block; object-fit:cover; max-height:45vh;">
</div>

<!-- ——— SCHEDULE ——— -->
<div id="programma" class="timeline-section paper-texture paper-texture-dark">
  <div class="timeline-content" data-reveal>
    <div class="section-script">Programma</div>
    <div class="section-label">12 Settembre 2026</div>

    <div class="timeline">
      <div class="tl-item left">
        <div class="tl-side">
          <div class="tl-event">Cerimonia</div>
        </div>
        <div class="tl-center">
          <div class="tl-line-segment bottom" style="background: linear-gradient(to bottom, transparent, var(--sabbia));"></div>
          <span class="tl-dot-time">15:00</span>
          <div class="tl-line-segment bottom"></div>
        </div>
        <div class="tl-side"></div>
      </div>

      <div class="tl-item right">
        <div class="tl-side">
          <div class="tl-event">Aperitivo</div>
        </div>
        <div class="tl-center">
          <div class="tl-line-segment"></div>
          <span class="tl-dot-time">17:00</span>
          <div class="tl-line-segment bottom"></div>
        </div>
        <div class="tl-side"></div>
      </div>

      <div class="tl-item left">
        <div class="tl-side">
          <div class="tl-event">Cena</div>
        </div>
        <div class="tl-center">
          <div class="tl-line-segment"></div>
          <span class="tl-dot-time">19:30</span>
          <div class="tl-line-segment bottom"></div>
        </div>
        <div class="tl-side"></div>
      </div>

      <div class="tl-item right">
        <div class="tl-side">
          <div class="tl-event">Primo Ballo</div>
        </div>
        <div class="tl-center">
          <div class="tl-line-segment"></div>
          <span class="tl-dot-time">22:00</span>
          <div class="tl-line-segment bottom"></div>
        </div>
        <div class="tl-side"></div>
      </div>

      <div class="tl-item left">
        <div class="tl-side">
          <div class="tl-event">Festa & Musica</div>
        </div>
        <div class="tl-center">
          <div class="tl-line-segment"></div>
          <span class="tl-dot-time">22:30</span>
          <div class="tl-line-segment bottom" style="background: linear-gradient(to bottom, var(--sabbia), transparent);"></div>
        </div>
        <div class="tl-side"></div>
      </div>
    </div>

  </div>
</div>

<!-- ——— PERNOTTO ——— -->
<div id="pernotto-section" class="pernotto-section" style="display: none;">
  <div class="pernotto-content" data-reveal>
    <div class="section-script">Pernotto</div>
    <div class="section-label">Dove Alloggerete</div>
    <p class="section-text" style="margin-bottom: 1.5rem;">
      Non dovete preoccuparvi di nulla,<br>il pernotto è offerto dagli sposi e alloggerete presso:
    </p>

    <div class="pernotto-box">
      <div id="hotel-map" class="pernotto-map"></div>
      <div class="pernotto-info">
        <div class="pernotto-name" id="hotelName"></div>
        <div class="pernotto-address" id="hotelAddress"></div>
        <button class="pernotto-btn" id="hotelMapsBtn" onclick="openHotelMaps(event)">
          <svg viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
          Apri in Maps
        </button>
      </div>
    </div>

    <!-- Selezione notti -->
    <div class="nights-selection">
      <div class="nights-label">Seleziona le notti</div>
      <p class="section-text" style="margin-bottom: 1rem; font-size: 0.95rem; color: var(--verde-scuro); opacity: 0.7;">
        Potete selezionare anche entrambe le notti,<br>saremo felici di avervi con noi più a lungo
      </p>
      <div class="night-items">
        <div class="night-item" id="nightPre" onclick="toggleNight('pre')">
          <div class="night-check">
            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>
          </div>
          <div class="night-info">
            <div class="night-date">Notte dell'11 Settembre</div>
            <div class="night-desc">La sera prima del matrimonio</div>
          </div>
        </div>
        <div class="night-item selected" id="nightMatrimonio" onclick="toggleNight('matrimonio')">
          <div class="night-check">
            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>
          </div>
          <div class="night-info">
            <div class="night-date">Notte del 12 Settembre</div>
            <div class="night-desc">La notte del matrimonio</div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- ——— PRE-WEDDING PARTY ——— -->
<div id="prewedding-section" class="prewedding-section" style="display: none;">
  <div class="prewedding-content" data-reveal>
    <div class="section-script">Pre-Wedding</div>
    <div class="section-label">11 Settembre 2026 · dalle 18:00</div>
    <p class="prewedding-text">
      La sera prima del grande giorno ci piacerebbe<br>passare del tempo con gli amici più stretti,<br>tra un aperitivo in piscina e un pizza party.
    </p>
  </div>
</div>

<!-- ——— PHOTO PARTY ——— -->
<div id="party-photo" style="width:100%; overflow:hidden; line-height:0; display:none;">
  <img src="party.png" alt="" style="width:100%; height:auto; display:block; object-fit:cover; max-height:45vh;">
</div>

<!-- ——— GUEST LIST ——— -->
<div id="conferma" class="guest-page paper-texture">
  <div class="guest-content" data-reveal>
    <div class="section-script">Conferma</div>
    <div class="section-label">La Vostra Presenza</div>
    <p class="section-text" style="margin-bottom: 0.5rem;">Selezionate chi parteciperà agli eventi</p>
    
    <div class="rsvp-columns">
      <!-- Colonna Matrimonio -->
      <div class="rsvp-column">
        <div class="rsvp-column-header">
          <div class="rsvp-column-icon">
            <i data-lucide="heart" class="rsvp-icon"></i>
          </div>
          <div class="rsvp-column-title">Matrimonio</div>
          <div class="rsvp-column-subtitle">12 Settembre 2026</div>
        </div>
        <div class="guest-list" id="guestListMatrimonio"></div>
        <div class="guest-counter" id="counterMatrimonio"></div>
      </div>

      <!-- Colonna Pool Party (solo se ci sono invitati abilitati) -->
      <div class="rsvp-column" id="poolPartyColumn" style="display: none;">
        <div class="rsvp-column-header">
          <div class="rsvp-column-icon">
            <i data-lucide="waves" class="rsvp-icon"></i>
          </div>
          <div class="rsvp-column-title">Pre-Wedding</div>
          <div class="rsvp-column-subtitle">11 Settembre 2026</div>
        </div>
        <div class="guest-list" id="guestListPoolParty"></div>
        <div class="guest-counter" id="counterPoolParty"></div>
      </div>
    </div>
  </div>

</div>

<!-- ——— INTOLLERANZE & MESSAGGIO ——— -->
<div class="message-page paper-texture">
  <div class="message-content" data-reveal>
    
    <!-- Note -->
    <div class="section-script">Note</div>
    <div class="section-label">Intolleranze & Comunicazioni</div>
    <p class="section-text" style="margin-bottom: 1.5rem;">
      Segnalateci eventuali intolleranze, allergie<br>o qualsiasi cosa vogliate comunicarci
    </p>
    
    <div class="input-wrapper">
      <textarea 
        id="intolleranzeField" 
        class="elegant-textarea" 
        placeholder="Es. intolleranze alimentari, allergie, note..."
        rows="4"
      ></textarea>
    </div>

  </div>
</div>

<!-- ——— CONFERMA ——— -->
<div style="background: var(--crema-chiaro);">
  <div class="confirm-wrapper">
    <button class="confirm-btn" id="confirmBtn" onclick="confirmRSVP()">Conferma tutto e invia</button>
    <p style="font-family: 'Cormorant Garamond', serif; font-style: italic; font-weight: 300; font-size: 0.9rem; color: var(--sabbia-scuro); margin-top: 1rem; line-height: 1.5; text-align: center;">
      Le vostre scelte potranno essere modificate in qualsiasi momento ritornando su questo sito.
    </p>
  </div>
</div>

<!-- ——— IBAN ——— -->
<div class="iban-section">
  <div class="iban-content" data-reveal>
    <div class="section-script">Un Gesto d'Affetto</div>
    <div class="section-label">&nbsp;</div>
    <p class="section-text" style="margin-bottom: 1.8rem;">
      La vostra presenza è il regalo più bello.<br>
      Se desiderate accompagnarla con un pensiero,<br>
      potete farlo tramite bonifico.
    </p>

    <div class="iban-box">
      <div class="iban-intestatario">Giulia Rossi & Marco Bianchi</div>
      <div class="iban-code" id="ibanCode">IT60 X054 2811 1010 0000 1234 567</div>
      <button class="iban-copy-btn" onclick="copyIban()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
        Copia IBAN
      </button>
    </div>
  </div>
</div>

<!-- ——— FOOTER ——— -->
<div class="footer paper-texture paper-texture-dark">
  <div class="footer-names">GIULIA <span class="footer-and">e</span> MARCO</div>
  <div class="footer-date">12 · Settembre · 2026</div>
  <div class="footer-love">con amore</div>
</div>

<div class="toast" id="toast"></div>

</div><!-- .phone-frame -->

<script>
// ——— HERO VIDEO DUAL SYSTEM ———
// Video 2 (bg-2) parte per primo, poi video 1 (hero-bg) fa il boomerang loop
// Dopo 60 secondi, video 2 riparte sopra video 1
(function() {
  const heroVideo = document.getElementById('heroVideo');
  const heroVideo2 = document.getElementById('heroVideo2');
  if (!heroVideo || !heroVideo2) return;
  
  let reverseInterval = null;
  let isPlayingVideo2 = false;
  let lastVideo2PlayTime = 0;
  const VIDEO2_INTERVAL = 60000; // 60 secondi = 1 minuto

  // Forza rimozione controlli
  heroVideo.controls = false;
  heroVideo.removeAttribute('controls');
  heroVideo2.controls = false;
  heroVideo2.removeAttribute('controls');

  // Funzione per avviare il video 2
  function playVideo2() {
    if (isPlayingVideo2) return;
    
    isPlayingVideo2 = true;
    lastVideo2PlayTime = Date.now();
    
    // Mostra video 2 sopra video 1
    heroVideo2.classList.add('active');
    heroVideo2.currentTime = 0;
    heroVideo2.play();
  }

  // Quando video 2 finisce, avvia video 1 da zero e torna al loop
  heroVideo2.addEventListener('ended', function() {
    heroVideo2.classList.remove('active');
    isPlayingVideo2 = false;
    // Avvia video 1 dall'inizio per transizione fluida
    heroVideo.currentTime = 0;
    heroVideo.play();
  });

  // Funzione per controllare se è ora di riprodurre video 2
  function checkVideo2Timing() {
    const now = Date.now();
    if (!isPlayingVideo2 && (now - lastVideo2PlayTime) >= VIDEO2_INTERVAL) {
      playVideo2();
    }
  }

  // Video 1: Quando arriva alla fine, inverti (effetto boomerang)
  heroVideo.addEventListener('ended', function() {
    // Prima controlla se deve partire video 2
    checkVideo2Timing();
    
    // Se video 2 sta andando, aspetta che finisca
    if (isPlayingVideo2) {
      return; // video 2 ended handler si occuperà di riavviare video 1
    } else {
      startBoomerangReverse();
    }
  });

  function startBoomerangReverse() {
    reverseInterval = setInterval(() => {
      if (heroVideo.currentTime <= 0.05) {
        clearInterval(reverseInterval);
        heroVideo.currentTime = 0;
        heroVideo.play();
      } else {
        heroVideo.currentTime -= 0.033;
      }
    }, 33);
  }

  // Forza autoplay — parte subito con bg-2
  function tryPlay() {
    heroVideo.muted = true;
    heroVideo2.muted = true;
    heroVideo.play().then(() => {
      // Browser pronto, avvia bg-2 sopra
      playVideo2();
    }).catch(() => {
      setTimeout(tryPlay, 100);
    });
  }
  
  // Avvia subito e anche su interazione utente
  tryPlay();
  document.addEventListener('touchstart', tryPlay, { once: true });
  document.addEventListener('click', tryPlay, { once: true });
})();
</script>

<script>
// ——— VIDEO INTRO ———
const videoIntro = document.getElementById('videoIntro');
const introVideo = document.getElementById('introVideo');
const sealHotspot = document.getElementById('sealHotspot');
const tapHint = document.getElementById('tapHint');

let videoStarted = false;

// Forza caricamento primo frame e mostra scritta insieme
introVideo.addEventListener('loadedmetadata', function() {
  introVideo.currentTime = 0.001;
});

introVideo.addEventListener('seeked', function() {
  // Il primo frame è pronto, mostra la scritta
  tapHint.classList.add('visible');
});

// Click sul sigillo
sealHotspot.addEventListener('click', function() {
  if (videoStarted) return;
  videoStarted = true;
  
  // Nascondi hint
  tapHint.classList.add('hidden');
  sealHotspot.style.display = 'none';
  
  // Riporta all'inizio, attiva audio e avvia
  introVideo.currentTime = 0;
  introVideo.muted = false;
  introVideo.play();
});

// Quando il video finisce
introVideo.addEventListener('ended', function() {
  videoIntro.classList.add('fade-out');
  document.body.classList.remove('no-scroll');
  const pf = document.querySelector('.phone-frame');
  if (pf) pf.style.overflow = 'auto';
  setTimeout(() => {
    videoIntro.classList.add('hidden');
  }, 1200);
});

// Dissolvenza a 3 secondi
introVideo.addEventListener('timeupdate', function() {
  if (introVideo.currentTime >= 3 && !videoIntro.classList.contains('fade-out')) {
    videoIntro.classList.add('fade-out');
    document.body.classList.remove('no-scroll');
    setTimeout(() => {
      videoIntro.classList.add('hidden');
      introVideo.pause();
    }, 1200);
  }
});

// Fallback: doppio tap per saltare
videoIntro.addEventListener('dblclick', function() {
  videoIntro.classList.add('fade-out');
  document.body.classList.remove('no-scroll');
  setTimeout(() => {
    videoIntro.classList.add('hidden');
  }, 1200);
});
</script>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>
<script>
let guests = [];
let family = null;

const params = new URLSearchParams(window.location.search);
const token = params.get("token");

if (!token) {
  document.getElementById("guestListMatrimonio").innerHTML = "<div class='no-pool-guests'>Token non valido</div>";
}

async function loadData() {
  const { data: fam, error: famError } = await supabaseClient
    .from("families")
    .select("*")
    .eq("token", token)
    .single();

  if (famError || !fam) {
    document.getElementById("guestListMatrimonio").innerHTML = "<div class='no-pool-guests'>Famiglia non trovata</div>";
    return;
  }

  family = fam;

  // ——— PERNOTTO ———
  if (family.pernotto) {
    document.getElementById('pernotto-section').style.display = 'block';
    
    const hotelNameEl = document.getElementById('hotelName');
    if (family.link_hotel && family.nome_hotel) {
      hotelNameEl.innerHTML = `<a href="${family.link_hotel}" target="_blank">${family.nome_hotel}</a>`;
    } else {
      hotelNameEl.textContent = family.nome_hotel || '';
    }
    document.getElementById('hotelAddress').textContent = family.indirizzo_hotel || '';
    
    // Inizializza mappa hotel solo se ci sono coordinate
    if (family.coordinate_hotel) {
      try {
        const coords = family.coordinate_hotel.split(',').map(c => parseFloat(c.trim()));
        if (coords.length === 2 && !isNaN(coords[0]) && !isNaN(coords[1])) {
          const hotelMap = L.map('hotel-map', {
            center: coords,
            zoom: 15,
            zoomControl: false,
            attributionControl: true
          });

          L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OSM &copy; CARTO',
            subdomains: 'abcd',
            maxZoom: 19
          }).addTo(hotelMap);

          L.control.zoom({ position: 'topright' }).addTo(hotelMap);

          const hotelMarker = L.divIcon({
            html: `<svg width="32" height="42" viewBox="0 0 32 42" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16 0C7.16 0 0 7.16 0 16c0 12 16 26 16 26s16-14 16-26C32 7.16 24.84 0 16 0z" fill="#7A8B72"/>
              <circle cx="16" cy="15" r="6" fill="#F7F0E2"/>
            </svg>`,
            className: '',
            iconSize: [32, 42],
            iconAnchor: [16, 42],
            popupAnchor: [0, -38]
          });

          L.marker(coords, { icon: hotelMarker })
            .addTo(hotelMap)
            .bindPopup(`<div style="font-family:Cormorant Garamond,serif;text-align:center;padding:6px 10px;"><strong style="color:#5F6E58;letter-spacing:0.05em;font-size:1rem;">${family.nome_hotel || ''}</strong><br><span style="font-style:italic;color:#96A88E;font-size:0.85rem;">${family.indirizzo_hotel || ''}</span></div>`, { offset: [0, 4] });
        }
      } catch(e) {
        console.log('Coordinate hotel non valide:', e);
      }
    }

    // Re-observe per animazione reveal
    const pernottoEl = document.querySelector('.pernotto-content');
    if (pernottoEl && typeof obs !== 'undefined') obs.observe(pernottoEl);
    
    loadNightSelections();
  }

  if (family.intolleranze) {
    document.getElementById('intolleranzeField').value = family.intolleranze;
  }

  const { data: gs, error: guestsError } = await supabaseClient
    .from("guests")
    .select("*")
    .eq("family_id", family.id);

  if (guestsError) {
    document.getElementById("guestListMatrimonio").innerHTML = "<div class='no-pool-guests'>Errore caricamento invitati</div>";
    return;
  }

  guests = gs;
  renderGuests();
}

function createGuestItem(guest, index, type) {
  const isMatrimonio = type === 'matrimonio';
  const isSelected = isMatrimonio ? guest.presenza_matrimonio : guest.presenza_pool_party;
  
  const el = document.createElement('div');
  el.className = `guest-item ${isSelected ? 'selected' : ''}`;
  el.dataset.index = index;
  el.dataset.type = type;

  el.innerHTML = `
    <div class="guest-check">
      <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>
    </div>
    <div class="guest-info">
      <div class="guest-name">${guest.nome}</div>
    </div>
  `;

  el.addEventListener('click', () => {
    const idx = parseInt(el.dataset.index);
    
    if (type === 'matrimonio') {
      guests[idx].presenza_matrimonio = !guests[idx].presenza_matrimonio;
    } else {
      guests[idx].presenza_pool_party = !guests[idx].presenza_pool_party;
    }
    
    el.classList.toggle('selected');
    updateCounters();
  });

  return el;
}

function createSingleGuestToggle(guest, index, type) {
  const isMatrimonio = type === 'matrimonio';
  const isSelected = isMatrimonio ? guest.presenza_matrimonio : guest.presenza_pool_party;
  
  const wrapper = document.createElement('div');
  wrapper.className = 'single-guest-toggle';

  const yesEl = document.createElement('div');
  yesEl.className = `guest-item ${isSelected ? 'selected' : ''}`;
  yesEl.innerHTML = `
    <div class="guest-check">
      <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>
    </div>
    <div class="guest-info">
      <div class="guest-name">Parteciperò</div>
    </div>
  `;

  const noEl = document.createElement('div');
  noEl.className = `guest-item ${!isSelected ? 'selected' : ''}`;
  noEl.innerHTML = `
    <div class="guest-check">
      <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>
    </div>
    <div class="guest-info">
      <div class="guest-name">Non parteciperò</div>
    </div>
  `;

  function updateToggle(partecipa) {
    if (type === 'matrimonio') {
      guests[index].presenza_matrimonio = partecipa;
    } else {
      guests[index].presenza_pool_party = partecipa;
    }
    yesEl.classList.toggle('selected', partecipa);
    noEl.classList.toggle('selected', !partecipa);
    updateCounters();
  }

  yesEl.addEventListener('click', () => updateToggle(true));
  noEl.addEventListener('click', () => updateToggle(false));

  wrapper.appendChild(yesEl);
  wrapper.appendChild(noEl);
  return wrapper;
}

function renderGuests() {
  const containerMatrimonio = document.getElementById('guestListMatrimonio');
  const containerPoolParty = document.getElementById('guestListPoolParty');
  const poolPartyColumn = document.getElementById('poolPartyColumn');
  
  containerMatrimonio.innerHTML = "";
  containerPoolParty.innerHTML = "";

  const poolPartyGuests = guests.filter(g => g.pool_party_invited);
  
  if (poolPartyGuests.length > 0) {
    poolPartyColumn.style.display = 'block';
    
    // Mostra sezione Pre-Wedding Party e foto
    document.getElementById('prewedding-section').style.display = 'block';
    document.getElementById('party-photo').style.display = 'block';
    
    // Observe per animazione reveal
    const preweddingEl = document.querySelector('.prewedding-content');
    if (preweddingEl && typeof obs !== 'undefined') obs.observe(preweddingEl);
  } else {
    poolPartyColumn.style.display = 'none';
    document.getElementById('prewedding-section').style.display = 'none';
    document.getElementById('party-photo').style.display = 'none';
  }

  const isSingle = guests.length === 1;

  // Matrimonio
  guests.forEach((g, i) => {
    containerMatrimonio.appendChild(createGuestItem(g, i, 'matrimonio'));
  });

  // Pool Party
  guests.forEach((g, i) => {
    if (g.pool_party_invited) {
      containerPoolParty.appendChild(createGuestItem(g, i, 'pool'));
    }
  });

  updateCounters();
}

function updateCounters() {
  const matrimonioCount = guests.filter(g => g.presenza_matrimonio).length;
  const poolPartyCount = guests.filter(g => g.pool_party_invited && g.presenza_pool_party).length;
  const poolPartyTotal = guests.filter(g => g.pool_party_invited).length;

  document.getElementById('counterMatrimonio').innerHTML = 
    `<span>${matrimonioCount}</span> di ${guests.length} partecipanti`;
  
  if (poolPartyTotal > 0) {
    document.getElementById('counterPoolParty').innerHTML = 
      `<span>${poolPartyCount}</span> di ${poolPartyTotal} partecipanti`;
  }
}

async function confirmRSVP() {
  const btn = document.getElementById('confirmBtn');
  btn.disabled = true;
  btn.textContent = 'Invio in corso...';

  const intolleranze = document.getElementById('intolleranzeField').value.trim();

  try {
    for (const g of guests) {
      await supabaseClient
        .from('guests')
        .update({
          presenza_matrimonio: g.presenza_matrimonio || false,
          presenza_pool_party: g.presenza_pool_party || false
        })
        .eq('id', g.id);
    }

    await supabaseClient
      .from('families')
      .update({ intolleranze: intolleranze || null })
      .eq('id', family.id);

    // Salva notti pernotto se la sezione è attiva
    if (family.pernotto) {
      await supabaseClient
        .from('families')
        .update({
          notte_pre: nightSelection.pre,
          notte_matrimonio: nightSelection.matrimonio
        })
        .eq('id', family.id);
    }

    btn.classList.add('sent');
    btn.textContent = 'Confermato ✓';
    showToast('Grazie! Risposte salvate con successo');
  } catch (error) {
    console.error('Errore:', error);
    btn.disabled = false;
    btn.textContent = 'Conferma';
    showToast('Errore nel salvataggio');
  }
}

function showToast(m) {
  const t = document.getElementById('toast');
  t.textContent = m;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

function scrollToSection(sectionId) {
  const section = document.getElementById(sectionId);
  if (section) {
    section.scrollIntoView({ behavior: 'smooth' });
  }
}

function copyIban() {
  const iban = document.getElementById('ibanCode').textContent.replace(/\s/g, '');
  navigator.clipboard.writeText(iban).then(() => {
    showToast('IBAN copiato');
  }).catch(() => {
    // Fallback per browser che non supportano clipboard API
    const textarea = document.createElement('textarea');
    textarea.value = iban;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    showToast('IBAN copiato');
  });
}

const VENUE_NAME = "Masseria San Michele, Martina Franca";

function addToCalendar() {
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  
  // ICS file content
  const icsContent = [
    'BEGIN:VCALENDAR',
    'VERSION:2.0',
    'PRODID:-//Giulia e Marco//Wedding//IT',
    'BEGIN:VEVENT',
    'DTSTART:20260912T130000Z',
    'DTEND:20260913T000000Z',
    'SUMMARY:Matrimonio Giulia & Marco',
    'LOCATION:Masseria San Michele\\, Strada Cupa 7\\, 74015 Martina Franca (TA)',
    'DESCRIPTION:Cerimonia ore 15:00 - Vi aspettiamo!',
    'END:VEVENT',
    'END:VCALENDAR'
  ].join('\r\n');
  
  // Google Calendar URL as fallback for Android
  const gcalUrl = 'https://calendar.google.com/calendar/render?action=TEMPLATE' +
    '&text=' + encodeURIComponent('Matrimonio Giulia & Marco') +
    '&dates=20260912T130000Z/20260913T000000Z' +
    '&location=' + encodeURIComponent('Masseria San Michele, Strada Cupa 7, 74015 Martina Franca (TA)') +
    '&details=' + encodeURIComponent('Cerimonia ore 15:00 - Vi aspettiamo!');
  
  if (isIOS) {
    // iOS: download .ics file
    const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'matrimonio-giulia-marco.ics';
    a.click();
    URL.revokeObjectURL(url);
  } else {
    // Android & Desktop: open Google Calendar
    window.open(gcalUrl, '_blank');
  }
}

function openMaps(e) {
  e.preventDefault();
  
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const isAndroid = /Android/.test(navigator.userAgent);
  const encodedName = encodeURIComponent(VENUE_NAME);
  
  if (isIOS) {
    window.location.href = `maps://maps.apple.com/?q=${encodedName}`;
  } else if (isAndroid) {
    window.location.href = `geo:0,0?q=${encodedName}`;
  } else {
    window.open(`https://www.google.com/maps/search/?api=1&query=${encodedName}`, '_blank');
  }
}

function openHotelMaps(e) {
  e.preventDefault();
  
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const isAndroid = /Android/.test(navigator.userAgent);
  const hotelName = family ? (family.nome_hotel || '') : '';
  const encoded = encodeURIComponent(hotelName + ', ' + (family ? family.indirizzo_hotel || '' : ''));
  
  if (isIOS) {
    window.location.href = `maps://maps.apple.com/?q=${encoded}`;
  } else if (isAndroid) {
    window.location.href = `geo:0,0?q=${encoded}`;
  } else {
    window.open(`https://www.google.com/maps/search/?api=1&query=${encoded}`, '_blank');
  }
}

// ——— NOTTI PERNOTTO ———
let nightSelection = { pre: false, matrimonio: true };

function toggleNight(night) {
  nightSelection[night] = !nightSelection[night];
  const el = document.getElementById(night === 'pre' ? 'nightPre' : 'nightMatrimonio');
  el.classList.toggle('selected');
}

function loadNightSelections() {
  if (!family) return;
  
  if (typeof family.notte_pre === 'boolean') {
    nightSelection.pre = family.notte_pre;
  }
  if (typeof family.notte_matrimonio === 'boolean') {
    nightSelection.matrimonio = family.notte_matrimonio;
  } else {
    nightSelection.matrimonio = true; // default selezionata
  }
  
  document.getElementById('nightPre').classList.toggle('selected', nightSelection.pre);
  document.getElementById('nightMatrimonio').classList.toggle('selected', nightSelection.matrimonio);
}

const wd = new Date('2026-09-12T15:00:00');
function tick() {
  const d = wd - new Date();
  if (d <= 0) {
    ['cd-days','cd-hours','cd-mins','cd-secs']
      .forEach(id => document.getElementById(id).textContent = '0');
    return;
  }
  document.getElementById('cd-days').textContent = Math.floor(d/(864e5));
  document.getElementById('cd-hours').textContent = Math.floor((d/36e5)%24);
  document.getElementById('cd-mins').textContent = Math.floor((d/6e4)%60);
  document.getElementById('cd-secs').textContent = Math.floor((d/1e3)%60);
}
setInterval(tick, 1000);
tick();

const obs = new IntersectionObserver(e =>
  e.forEach(x => { if (x.isIntersecting) x.target.classList.add('visible'); }),
  { threshold: 0.12 }
);
document.querySelectorAll('[data-reveal]').forEach(el => obs.observe(el));

</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script>
// ——— OSM + LEAFLET ———
const osmMap = L.map('osm-map', {
  center: [40.730, 17.32595],
  zoom: 12,
  zoomControl: false,
  attributionControl: true
});

// CartoDB Positron — stile minimal bianco
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/">CARTO</a>',
  subdomains: 'abcd',
  maxZoom: 19
}).addTo(osmMap);

// Zoom in alto a destra
L.control.zoom({ position: 'topright' }).addTo(osmMap);

// Marker SVG custom salvia
const markerIcon = L.divIcon({
  html: `<svg width="32" height="42" viewBox="0 0 32 42" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M16 0C7.16 0 0 7.16 0 16c0 12 16 26 16 26s16-14 16-26C32 7.16 24.84 0 16 0z" fill="#7A8B72"/>
    <circle cx="16" cy="15" r="6" fill="#F7F0E2"/>
  </svg>`,
  className: '',
  iconSize: [32, 42],
  iconAnchor: [16, 42],
  popupAnchor: [0, -38]
});

L.marker([40.72111, 17.32595], { icon: markerIcon })
  .addTo(osmMap)
  .bindPopup('<div style="font-family:Cormorant Garamond,serif;text-align:center;padding:6px 10px;"><strong style="color:#5F6E58;letter-spacing:0.05em;font-size:1rem;">Masseria San Michele</strong><br><span style="font-style:italic;color:#96A88E;font-size:0.85rem;">Strada Cupa 7, Martina Franca</span></div>', { offset: [0, 4] });
</script>
<script src="https://unpkg.com/lucide@latest"></script>
<script>
  lucide.createIcons();
  loadData();
</script>

</body>
</html>
